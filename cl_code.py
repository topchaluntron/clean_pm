import pandas as pd
import numpy as np

# à¸­à¹ˆà¸²à¸™à¹„à¸Ÿà¸¥à¹Œ Excel
df = pd.read_excel("_____________", parse_dates=["timestamp"])

# à¸à¸£à¸­à¸‡à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”
df = df[(df['timestamp'] >= '2023-01-01 01:00:00') & (df['timestamp'] <= '2024-12-31 23:59:59')]

# à¸¥à¸šà¹à¸–à¸§à¸—à¸µà¹ˆà¸¡à¸µà¸„à¹ˆà¸² pm_2_5 à¸¡à¸²à¸à¸à¸§à¹ˆà¸² 500 à¸«à¸£à¸·à¸­à¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²à¸«à¸£à¸·à¸­à¹€à¸—à¹ˆà¸²à¸à¸±à¸š 0
df = df[(df['pm_2_5'] > 0) & (df['pm_2_5'] <= 500)]

# à¸¥à¸šà¹à¸–à¸§à¸—à¸µà¹ˆà¸¡à¸µà¸„à¹ˆà¸² pm_10 à¸¡à¸²à¸à¸à¸§à¹ˆà¸² 300 à¸«à¸£à¸·à¸­à¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²à¸«à¸£à¸·à¸­à¹€à¸—à¹ˆà¸²à¸à¸±à¸š 0
df = df[(df['pm_10'] > 0) & (df['pm_10'] <= 500)]

# ðŸŽ¯ à¹€à¸žà¸´à¹ˆà¸¡à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œà¹€à¸à¸µà¹ˆà¸¢à¸§à¸à¸±à¸šà¹€à¸§à¸¥à¸²
df['month'] = df['timestamp'].dt.month              # à¹€à¸”à¸·à¸­à¸™
df['hour'] = df['timestamp'].dt.hour                # à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡

# ðŸŽ¯ à¹€à¸žà¸´à¹ˆà¸¡à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œ sin à¹à¸¥à¸° cos à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸”à¸·à¸­à¸™à¹à¸¥à¸°à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡
df['month_sin'] = np.sin(2 * np.pi * df['month'] / 12)  # à¸„à¹ˆà¸² sin à¸‚à¸­à¸‡à¹€à¸”à¸·à¸­à¸™
df['month_cos'] = np.cos(2 * np.pi * df['month'] / 12)  # à¸„à¹ˆà¸² cos à¸‚à¸­à¸‡à¹€à¸”à¸·à¸­à¸™

df['hour_sin'] = np.sin(2 * np.pi * df['hour'] / 24)    # à¸„à¹ˆà¸² sin à¸‚à¸­à¸‡à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡
df['hour_cos'] = np.cos(2 * np.pi * df['hour'] / 24)    # à¸„à¹ˆà¸² cos à¸‚à¸­à¸‡à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡

#à¹€à¸­à¸²à¸›à¸µ/à¹€à¸”à¸·à¸­à¸™à¸­à¸­à¸
df = df.drop(columns=['year', 'day'])

# à¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸Ÿà¸¥à¹Œà¹ƒà¸«à¸¡à¹ˆ
new_file_name = 'time_feature.xlsx'
df.to_excel(new_file_name, index=False)

print("File saved successfully!")
print("""
                 \ (â€¢â—¡â€¢) /
                  \     /
                    -o-
                   |   |
                   |_  |_""")
